(()=>{var e={397:e=>{self,e.exports=(()=>{"use strict";var e={d:(t,i)=>{for(var n in i)e.o(i,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{ERROR_LIMIT:()=>i,reportError:()=>r}),Error;const i=10;let n=0,s=!1;const r=e=>{return void 0,void 0,r=function*(){var t,r;if(!e.bypassErrorLimit&&n>=i){if(s)return;e.code="ERROR_LIMIT_EXCEEDED",s=!0}n++;const o=(1e7*Math.random()).toFixed(0).toString(),c=new URLSearchParams;c.append("use_sandbox",(null===(t=e.useSandbox)||void 0===t?void 0:t.toString())||"false"),c.append("error_id",o),c.append("partner_url",window.location.href),c.append("rokt_tag_id",e.tagId),c.append("severity",e.severity||"WARNING"),e.code&&c.append("code",e.code),e.integration&&c.append("integration",e.integration),e.stack&&(e.stack.length>400&&(e.stack=e.stack.substring(0,400)),c.append("stack",e.stack));const a=e.reporter?`frame-${e.reporter}`:"frame";c.append("reporter",a),e.additionalInformation=e.additionalInformation||{},e.additionalInformation.name=e.additionalInformation.name||e.name,e.additionalInformation.message=e.additionalInformation.message||e.message,c.append("additional_information",JSON.stringify(e.additionalInformation));const l=document.createElement("iframe");l.src=`https://apps.rokt.com/wsdk/reporter/index.html?${c.toString()}`,l.style.display="none";const d=new Promise((e=>{const t=i=>{var n,s,r;"Rokt.Reporter.Close"!==(null===(n=i.data)||void 0===n?void 0:n.action)&&(null===(r=null===(s=i.data)||void 0===s?void 0:s.payload)||void 0===r?void 0:r.errorId)!==o||(e(),window.removeEventListener("message",t))};window.addEventListener("message",t)}));(window.document.body||window.document.head).appendChild(l),yield d,null===(r=l.parentElement)||void 0===r||r.removeChild(l)},new((t=void 0)||(t=Promise))((function(e,i){function n(e){try{o(r.next(e))}catch(e){i(e)}}function s(e){try{o(r.throw(e))}catch(e){i(e)}}function o(i){var r;i.done?e(i.value):(r=i.value,r instanceof t?r:new t((function(e){e(r)}))).then(n,s)}o((r=r.apply(undefined,[])).next())}));var t,r};return t})()}},t={};function i(n){var s=t[n];if(void 0!==s)return s.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,i),r.exports}(()=>{"use strict";class e{constructor(){this.fulfilled=!1,this.rejected=!1,this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t})).then((e=>(this.fulfilled=!0,e)),(e=>{throw this.rejected=!0,e}))}isFulfilled(){return this.fulfilled}isPending(){return!this.isFulfilled()&&!this.isRejected()}isRejected(){return this.rejected}static resolve(t){const i=new e;return i.resolve(t),i}}const t="LAUNCHER_DUPLICATE_SELECT_PLACEMENTS",n={AttributesCapture:"ATTRIBUTES_CAPTURE",AttributesCaptureFailure:"ATTRIBUTES_CAPTURE_FAILURE",PageIdUpdated:"PAGE_ID_UPDATED",PageInstanceGuidUpdated:"PAGE_INSTANCE_GUID_UPDATED",PageVariantNameUpdated:"PAGE_VARIANT_NAME_UPDATED",SessionIdUpdated:"SESSION_ID_UPDATED"},s={Default:"default",Preload:"preload"},r={OFFER_ENGAGEMENT:"OFFER_ENGAGEMENT",POSITIVE_ENGAGEMENT:"POSITIVE_ENGAGEMENT",OFFER_POSITIVE_ENGAGEMENT:"OFFER_POSITIVE_ENGAGEMENT",PLACEMENT_CLOSED:"PLACEMENT_CLOSED",PLACEMENT_COMPLETED:"PLACEMENT_COMPLETED",PLACEMENT_INTERACTIVE:"PLACEMENT_INTERACTIVE",PLACEMENT_READY:"PLACEMENT_READY",PLACEMENT_RESIZE:"PLACEMENT_RESIZE",PLACEMENT_FAILURE:"PLACEMENT_FAILURE",UPDATE_CART_ITEM_MESSAGE:"UPDATE_CART_ITEM_MESSAGE",DISPLAY_SETTINGS_SET:"DISPLAY_SETTINGS_SET"},o="[L] PUT_DISPLAY_SETTINGS",c="[L] CLOSE_PLACEMENT",a="[L] FAILED_TO_LOAD_PLUGIN",l="[L] PLUGIN_TO_PARTNER",d="[L] PLUGIN_RESIZED",u="rokt-frame-type",h="PLUGIN_FRAME_CREATED",v="Standard",p="Fulfillment",m="NO_SNIPPET",f="NO_TAG_ID";class _{constructor(){this._subscribers=[]}add(e){this._subscribers.push(e)}unsubscribe(){this._subscribers.forEach((e=>e.unsubscribe()))}}const g=()=>{},w=(e=g,t=g,i=g)=>"function"!=typeof e?e:{next:e,error:t,complete:i};class y{constructor(e){this._setupFn=e}subscribe(e,t,i){const n=w(e,t,i);let s,r=!0;const o={next:e=>{r&&n.next(e)},complete:()=>{r&&(s&&s(),n.complete(),r=!1)},error:e=>{r&&(n.error(e),r=!1)}};s=this._setupFn(o),r||s&&s();const c=new _;return c.add({unsubscribe:()=>{s&&s(),r=!1}}),c}}class b extends y{constructor(){super((e=>(this._isComplete&&e.complete(),this._observers.push(e),()=>this._observers=this._observers.filter((t=>t!==e))))),this._observers=[],this._isComplete=!1}next(e){for(const t of this._observers)t.next(e)}error(e){for(const t of this._observers)t.error(e)}complete(){this._isComplete=!0;for(const e of this._observers)e.complete()}asObservable(){return new y((e=>{const t=this.subscribe(e);return()=>t.unsubscribe()}))}}class S extends b{constructor(e=-1){super(),this._buffer=[],this._bufferLength=e}subscribe(e,t,i){const n=w(e,t,i);return this._buffer.forEach((e=>n.next(e))),super.subscribe(e,t,i)}next(e){-1!==this._bufferLength&&this._buffer.length===this._bufferLength?(this._buffer.shift(),this._buffer.push(e)):this._buffer.push(e),super.next(e)}}const E=e=>new Promise(((t,i)=>{let n;e.subscribe((e=>n=e),(e=>i(e)),(()=>t(n)))})),I=(e,t)=>new y((i=>{const n=e=>i.next(e);return e.addEventListener(t,n),()=>e.removeEventListener(t,n)})),T=(...e)=>new y((t=>{const i=new _;let n=0;for(const s of e)i.add(s.subscribe((e=>t.next(e)),(e=>t.error(e)),(()=>{n+=1,n>=e.length&&t.complete()})));return()=>i.unsubscribe()}));function A(e,t){return new R(e,t)}class R{constructor(e,t){this._target=e,this._handler=t}subscribe(e,t,i){const n=e.next?e.next.bind(e):e,s={next:(...e)=>{return t=this,i=void 0,r=function*(){try{yield n(...e)}catch(e){this._handler(e)}},new((s=void 0)||(s=Promise))((function(e,n){function o(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof s?i:new s((function(e){e(i)}))).then(o,c)}a((r=r.apply(t,i||[])).next())}));var t,i,s,r},error:e.error?e.error.bind(e):t,complete:e.complete?e.complete.bind(e):i};return this._target.subscribe(s)}}class P{constructor(e){this.value=e,this.complete=!1,this.skip=!1}}const O=e=>(...t)=>new y((i=>{const n=e.subscribe((e=>{return n=void 0,s=void 0,o=function*(){try{let n=new P(e);for(const e of t){const t=e(n);if(n=t.then?yield t:t,!0===n.skip||!0===n.complete)break}if(n.skip)return;i.next(n.value),!0===n.complete&&i.complete()}catch(e){i.error(e)}},new((r=void 0)||(r=Promise))((function(e,t){function i(e){try{a(o.next(e))}catch(e){t(e)}}function c(e){try{a(o.throw(e))}catch(e){t(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(i,c)}a((o=o.apply(n,s||[])).next())}));var n,s,r,o}),(e=>i.error(e)),(()=>i.complete()));return()=>n.unsubscribe()})),C=e=>t=>(!1===e(t.value)&&(t.skip=!0),t),N=e=>t=>(e?!0===e(t.value)?t.complete=!0:t.skip=!0:t.complete=!0,t),L=e=>t=>{const i=e(t.value);return new P(i)},x=e=>e.send(),k="ERROR",D="WARNING";class U extends Error{constructor(e,t){var i,n;super(e),this.name=null!==(i=null==t?void 0:t.name)&&void 0!==i?i:this.name,this.code=null==t?void 0:t.code,this.additionalInformation=null==t?void 0:t.additionalInformation,this.handled=null!==(n=null==t?void 0:t.handled)&&void 0!==n&&n,this.severity=(null==t?void 0:t.severity)||k}}var F=i(397);new RegExp("^\\d{4}-\\d{2}-\\d{2}((T\\d{2}:\\d{2}(:\\d{2})?)(\\.\\d{1,6})?(Z|(\\+|-)\\d{2}:\\d{2})?)?$");const M=(e=0)=>new Promise((t=>setTimeout(t,e)));function j(e,t=3,i=100,n=(()=>!0)){return s=this,r=void 0,c=function*(){try{return yield e()}catch(e){if(t<=1||!n(e))throw e}return yield M(1*i),yield j(e,t-1,i)},new((o=void 0)||(o=Promise))((function(e,t){function i(e){try{a(c.next(e))}catch(e){t(e)}}function n(e){try{a(c.throw(e))}catch(e){t(e)}}function a(t){var s;t.done?e(t.value):(s=t.value,s instanceof o?s:new o((function(e){e(s)}))).then(i,n)}a((c=c.apply(s,r||[])).next())}));var s,r,o,c}function G(e){return function(e){return!isNaN(parseFloat(e))&&isFinite(e)}(e)?parseInt(e,10):0}function W(){const e=document.body.querySelectorAll("*");return Array.from(e).filter((e=>e&&e.nodeType===Node.ELEMENT_NODE)).reduce(((e,t)=>{const i=G(document.defaultView.getComputedStyle(t).getPropertyValue("z-index")),n=G(t.style&&t.style.zIndex);return Math.max(e,i,n)}),0)}const H=(e,t={})=>{for(const[i,n]of Object.entries(t))e.style[i]=n};class V{constructor(e){this.window=e}getCookie(e){try{const t=this.window.document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));if(t)return t[2]}catch(e){}}setCookie(e){try{this.window.document.cookie=this.serialize(e)}catch(e){}}serialize(e){const{name:t,path:i="/",sameSite:n,secure:s,value:r}=e;let{expires:o}=e;if(!o){const e=new Date;e.setTime(e.getTime()+31536e6),o=e}let c=`${t}=${r};expires=${o.toUTCString()};path=${i}`;return s&&(c+=";secure"),n&&(c+=`;samesite=${n}`),c}}const B=()=>{if("undefined"==typeof window)throw new Error("NO_WINDOW");return window};class ${constructor(e){this.window=e}getItem(e){try{const t=this.window.localStorage.getItem(e);if(null===t)return;return t}catch(e){return}}setItem(e,t){try{this.window.localStorage.setItem(e,t)}catch(e){}}}const K="RoktRecogniser";class z extends class{constructor(e,t,i){this.cookieService=e,this.localStorageService=t,this.sameSite=i}setRecogniser(e){e.cookie&&this.cookieService.setCookie({name:K,sameSite:this.sameSite,secure:!0,value:e.cookie}),e.localStorage&&this.localStorageService.setItem(K,e.localStorage)}getRecogniser(){return{cookie:this.cookieService.getCookie(K),localStorage:this.localStorageService.getItem(K)}}}{constructor(e,t){super(e,t,"lax")}}function Y(){return window.crypto||window.msCrypto}function X(e){return Array.from(new Uint8Array(e)).map((e=>e.toString(16).padStart(2,"0"))).join("")}function q(e){return new Promise(((t,i)=>{const n=function(e){if(window.TextEncoder)return(new TextEncoder).encode(e);const t=unescape(encodeURIComponent(e)),i=new Uint8Array(t.length);for(let e=0;e<t.length;e++)i[e]=t.charCodeAt(e);return i}(e),s=Y().subtle.digest("SHA-256",n);s.then?s.then((e=>{t(X(e))}),i):(s.oncomplete=e=>{const i=e.target.result;t(X(i))},s.onerror=e=>{i(e)})}))}var J=function(e,t,i){if(i||2===arguments.length)for(var n,s=0,r=t.length;s<r;s++)!n&&s in t||(n||(n=Array.prototype.slice.call(t,0,s)),n[s]=t[s]);return e.concat(n||Array.prototype.slice.call(t))},Z=function(e,t,i){this.name=e,this.version=t,this.os=i,this.type="browser"},Q=function(e){this.version=e,this.type="node",this.name="node",this.os=process.platform},ee=function(e,t,i,n){this.name=e,this.version=t,this.os=i,this.bot=n,this.type="bot-device"},te=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},ie=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},ne=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,se=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],re=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function oe(e){var t=function(e){return""!==e&&se.reduce((function(t,i){var n=i[0],s=i[1];if(t)return t;var r=s.exec(e);return!!r&&[n,r]}),!1)}(e);if(!t)return null;var i=t[0],n=t[1];if("searchbot"===i)return new te;var s=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);s?s.length<3&&(s=J(J([],s,!0),function(e){for(var t=[],i=0;i<e;i++)t.push("0");return t}(3-s.length),!0)):s=[];var r=s.join("."),o=function(e){for(var t=0,i=re.length;t<i;t++){var n=re[t],s=n[0];if(n[1].exec(e))return s}return null}(e),c=ne.exec(e);return c&&c[1]?new ee(i,r,o,c[1]):new Z(i,r,o)}function ce(e){return function(e){return e?oe(e):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new ie:"undefined"!=typeof navigator?oe(navigator.userAgent):"undefined"!=typeof process&&process.version?new Q(process.version.slice(1)):null}(e)}const ae="No Alias";function le(e=5){let t="";const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=i.length;for(let s=0;s<e;s++)t+=i.charAt(Math.floor(Math.random()*n));return t}class de extends Error{constructor(e,t){var i,n;super(e),this.name=null!==(i=null==t?void 0:t.name)&&void 0!==i?i:this.name,this.code=null==t?void 0:t.code,this.additionalInformation=null==t?void 0:t.additionalInformation,this.handled=null!==(n=null==t?void 0:t.handled)&&void 0!==n&&n}}class ue{constructor(e){this.ID=e.ID,this.eventType=e.eventType,this.body=e.body||{},this.headers=e.headers||{},this.hasError=e.hasError||!1,this.isResponse=!!e.isResponse}}var he=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};class ve{constructor(e){var t;this.options=e,this.id=this.options.id||le(10),this.alias=this.options.alias||ae,this.connection=this.options.connection,this.timeoutDuration=null!==(t=this.options.timeoutDuration)&&void 0!==t?t:1e4,this.interceptors=[]}addInterceptor(e){this.interceptors.push(e)}send(e,{body:t,headers:i={}}={}){return he(this,void 0,void 0,(function*(){const n=this.runInterceptors(this.createRequest(e,t,i)),s=new Promise(((t,i)=>he(this,void 0,void 0,(function*(){let s=!1;const r=setTimeout((()=>{s||(i(new de(`Request timed out for ${e}`,{code:"REQUEST_TIMEOUT_ERROR"})),s=!0)}),this.timeoutDuration);O(this.connection.onMessage)(N((e=>e.ID===n.ID))).subscribe((n=>{if(s)return;if(clearTimeout(r),!n)return void i(new de(`Wrong request format for ${e}`,{code:"REQUEST_FORMAT_ERROR"}));const o=this.runInterceptors(n);!0===o.hasError?i(o.body):t(o)}))}))));return this.connection.send(n),s}))}runInterceptors(e){const t=(e=>{const t=new WeakMap,i=e=>{if(!e||"object"!=typeof e)return e;let n;const s=Array.isArray(e)?[]:{},r=Object.getPrototypeOf(s);t.set(e,s);for(const o in e)r[o]||(n=e[o],n&&"object"==typeof n?t.get(n)?s[o]=t.get(n):s[o]=i(n):s[o]=n);return s};return i(e)})(e);for(const e of this.interceptors)e(t);return t}createRequest(e,t,i){return new ue({ID:le(10),eventType:e,body:t,headers:Object.assign({"sender-alias":this.alias,"sender-id":this.id},i)})}}var pe=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};const me=()=>new Promise((e=>{fe()&&e(window.rokt_wsdk_debug);const t=i=>{var n,s;"ROKT_WSDK_DEBUG"===(null===(n=i.data)||void 0===n?void 0:n.from)&&"READY"===(null===(s=i.data)||void 0===s?void 0:s.type)&&e(window.rokt_wsdk_debug),window.removeEventListener("message",t)};window.addEventListener("message",t)})),fe=()=>!!window.rokt_wsdk_debug,_e=e=>new y((t=>{let i;return me().then((n=>{i=n[e].subscribe((e=>t.next(e)))})),()=>i&&i.unsubscribe()})),ge=(_e("controller$"),_e("launcher$"),e=>pe(void 0,void 0,void 0,(function*(){(yield me()).onEvent(e)})));class we{constructor(e,t,i,n){this.connection=e,this.event=t,this.routerId=i,this.routerAlias=n,this.data={},this.isSent=!1,this.responseHeaders={}}getHeaders(){return this.event.headers}getEvent(){return this.event.eventType}getContext(e){return this.data[e]}setResponseHeader(e,t){this.responseHeaders[e]=t}setContext(e,t){this.data[e]=t}getBody(){return this.event.body}setBody(e){this.event.body=e}sendError(e){this.validate(e),e instanceof Error&&(e=this.convertErrorToObject(e));const t=new ue({ID:this.event.ID,eventType:this.event.eventType,body:e,headers:this.responseHeaders,hasError:!0,isResponse:!0});this.sendExtensionEvent(e,!0),this.connection.send(t),this.isSent=!0}send(e){this.validate(e);const t=new ue({ID:this.event.ID,eventType:this.event.eventType,body:e,headers:this.responseHeaders,isResponse:!0});this.sendExtensionEvent(e,!0),this.connection.send(t),this.isSent=!0}hasSent(){return this.isSent}validate(e){if(!0===this.isSent)throw{name:"HandlerContext.RESPONSE_ALREADY_SENT",message:"HandlerContext: Response already sent.",code:"RESPONSE_ALREADY_SENT",additionalInformation:{response:e}}}sendExtensionEvent(e,t=!1){ge({routerId:this.routerId,routerAlias:this.routerAlias,eventName:this.event.eventType,id:this.event.ID,headers:this.responseHeaders,body:e,hasError:t})}convertErrorToObject(e){return{message:e.message,name:e.name,stack:e.stack,code:e.code,additionalInformation:e.additionalInformation}}}var ye=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};class be{constructor(e){var t;this.options=e,this.onMessage=e=>t=>{const i=new we(this.connection,t,this.id,this.alias);return ge({routerId:this.id,routerAlias:this.alias,eventName:t.eventType,id:t.ID,body:t.body,headers:t.headers,hasError:!1}),((e,...t)=>ye(void 0,void 0,void 0,(function*(){const i=e;let n=!1;const[s,r]=function(e){const t=[];return[e.filter((e=>!(e.length>1&&(t.push(e),1)))),t]}(t),o=(e,t)=>ye(void 0,void 0,void 0,(function*(){if(!r.length)throw t;for(const i of r)yield i(e,t)}));for(const e of s)try{yield e(i)}catch(e){n=!0,yield o(i,e);break}n||i.hasSent()||(yield o(i,new Error(`Context: Response never sent for ${i.getEvent()}`)))})))(i,...this.middleware,...e)},this.id=this.options.id||le(10),this.connection=this.options.connection,this.alias=this.options.alias||ae,this.subscription=new _,this.handlers=[],this.middleware=[],t={id:this.id,alias:this.alias},pe(void 0,void 0,void 0,(function*(){(yield me()).onRouterConnect(t)}))}use(e){if(e instanceof class{constructor(){this.middleware=[],this.handlers={}}getHandlers(){const e={};for(const[t,i]of Object.entries(this.handlers))e[t]=[...this.middleware,...i];return e}use(e){this.middleware.push(e)}on(e,...t){this.handlers[e]=t}}){const t=e.getHandlers();for(const[e,i]of Object.entries(t))this.on(e,...i)}else this.middleware.push(e)}on(e,...t){if(this.handlers.includes(e))throw new Error("HandlerExists");this.handlers.push(e);const i=O(this.connection.onMessage)(C((t=>t.eventType===e)));this.subscription.add(i.subscribe(this.onMessage(t)))}close(){var e;this.subscription.unsubscribe(),e=this.id,pe(void 0,void 0,void 0,(function*(){(yield me()).onRouterDisconnect(e)}))}}var Se=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};class Ee{constructor(e,t){this.transmitter=e,this.router=t}eject(){return{transmitter:this.transmitter,router:this.router}}addInterceptor(e){return Se(this,void 0,void 0,(function*(){this.transmitter.addInterceptor(e)}))}send(e,t={}){return Se(this,void 0,void 0,(function*(){return this.transmitter.send(e,t)}))}use(e){return Se(this,void 0,void 0,(function*(){this.router.use(e)}))}on(e,...t){return Se(this,void 0,void 0,(function*(){this.router.on(e,...t)}))}close(){return Se(this,void 0,void 0,(function*(){this.router.close()}))}}var Ie=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};const Te="ERROR_SENT",Ae=(e,t)=>{!e.hasSent()&&t&&(e.sendError(t),((e,t)=>{e.setContext(Te,!0)})(e))},Re="[C] ERROR",Pe=e=>{if(!e.isResponse&&e.body instanceof Error){const t=e.body;e.body={name:t.name,message:t.message,stack:t.stack,code:t.code,additionalInformation:t.additionalInformation,handled:t.handled,level:t.level}}},Oe="rokt-controller-frame",Ce="name",Ne="initTimestamp",Le="launcherInstanceId",xe="noDeviceId",ke="sandbox",De="sessionId",Ue="tagId",Fe="customHeaders",Me="integrationType",je="integration",Ge="url",We="sessionRecogniser",He="serviceUrlOverride",Ve="launcherVersion";class Be{constructor(e,t){this.type=e,this.payload=t}}const $e="LINK_SENDING_DATA",Ke="LINK_CLIENT_READY_FOR_PORT",ze="LINK_HOST_PORT_TRANSFER",Ye="LINK_LISTENING";class Xe{constructor(e){this.port=e,this.onEvent=I(this.port,"message");const t=O(this.onEvent)(N((e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)===Ye})));this.onReady=E(t).then((()=>{})),this.onMessage=O(this.onEvent)(C((e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)===$e})),L((e=>e.data.payload))),this.port.start()}send(e){this.dispatch(e)}dispatch(e){return t=this,i=void 0,s=function*(){yield this.onReady;const t=new Be($e,e);this.port.postMessage(t)},new((n=void 0)||(n=Promise))((function(e,r){function o(e){try{a(s.next(e))}catch(e){r(e)}}function c(e){try{a(s.throw(e))}catch(e){r(e)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(o,c)}a((s=s.apply(t,i||[])).next())}));var t,i,n,s}}var qe=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))},Je=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};class Ze{constructor(e){this.options=e,this.onConnectionSubject=new b,this.connections={},this.handshakeFilter=e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)===Ke&&e.data.payload.ID===(this.options.ID||80)},this.handshake=e=>Je(this,void 0,void 0,(function*(){const t=le(20),i=new this.options.channelConstructor,{port1:n,port2:s}=i,r=new Xe(n);e.source&&(e.source.postMessage(new Be(ze),this.options.targetOrigin,[s]),yield r.onReady,this.connections[t]=r,this.onConnectionSubject.next(r),n.postMessage(new Be(Ye)))})),this.onConnection=this.onConnectionSubject.asObservable();const t=I(this.options.selfEventSource,"message");this.onPostMessage=O(t)(C(this.handshakeFilter)).subscribe(this.handshake)}destroy(){this.onPostMessage.unsubscribe()}connect(e){return Je(this,void 0,void 0,(function*(){const t=yield(({target:e,targetID:t=80,targetOrigin:i="*",selfEventSource:n,retryTimeout:s=1e3})=>qe(void 0,void 0,void 0,(function*(){const r=I(n,"message"),o=O(r)(N((e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)===ze}))),c=E(o);let a;setTimeout((()=>qe(void 0,void 0,void 0,(function*(){for(;void 0===a;)e.postMessage(new Be(Ke,{ID:t}),i),yield M(s)}))),0);const l=yield c;a=l.ports[0];const d=new Xe(a);return a.postMessage(new Be(Ye)),d})))({target:e.target,targetOrigin:this.options.targetOrigin||"*",selfEventSource:this.options.selfEventSource});return this.onConnectionSubject.next(t),t}))}}function Qe(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{return(("y"===e?8:0)^(t=new Uint8Array(1),Y().getRandomValues(t))[0]&15>>("y"===e?2:0)).toString(16);var t}))}function et(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))}Object.create,Object.create;const tt="__rokt-launcher__";let it;const nt={NoElementToPlacePlugin:"NoElementToPlacePlugin"};class st{constructor(e,t,i){this.services=e,this.pluginDetails=t,this.onResizeSubject$=new b,this.usingAutoResize=!1,this.attributeSet=!1,this.url=i?`${i}/wsdk/plugin-runtime/index.html`:this.services.urls.PLUGIN_RUNTIME_URL,this.element=((e={},...t)=>{const i=document.createElement(e.tag||"div");e.id&&(i.id=e.id),e.className&&(i.classList.value=e.className),e.cssText&&(i.style.cssText=e.cssText),e.styles&&H(i,e.styles),e.innerHTML&&(i.innerHTML=e.innerHTML),e.innerText&&(i.innerText=e.innerText),e.events&&((e,t={})=>{for(const[i,n]of Object.entries(t))e[i]=n})(i,e.events),e.attributes&&((e,t={})=>{for(const[i,n]of Object.entries(t))e.setAttribute(i,n)})(i,e.attributes);for(const e of t)"string"==typeof e?i.appendChild(document.createTextNode(e)):i.appendChild(e);return i})({tag:"iframe",styles:{border:0,width:"1px",minWidth:"100%",boxSizing:"border-box",display:"block"},id:`rokt-placement-${this.pluginDetails.pluginInstanceId}`,attributes:{[u]:"plugin-runtime"}}),this.onLoaded=new Promise((e=>this.element.onload=()=>e()))}getElement(){return this.element}setSandbox(e=[]){if(!0===this.attributeSet)throw new Error("Can only set attributes once");for(const t of["allow-scripts","allow-same-origin",...e])this.element.sandbox.add(t);this.attributeSet=!0}resetStyles(){this.element.removeAttribute("style")}removeStyles(e=[]){for(const t of e)this.element.style.removeProperty(t)}setStyles(e={}){H(this.element,e)}setSize(e,t){!1!==this.usingAutoResize&&(this.setStyles({height:`${e}px`,width:`${t}px`}),this.onResizeSubject$.next({height:e.toString(),width:t.toString()}))}setFullscreen(){const e=this.services.window.document.body;this.originalOverflowValue=e.style.overflow,e.style.overflow="hidden"}useAutoResizer(){this.usingAutoResize=!0}insert(e,t="child",i="append"){let n;switch(this.element.name=this.pluginDetails.configuration,this.element.src=this.url,`${t}-${i}`){case"sibling-prepend":n="beforebegin";break;case"child-prepend":n="afterbegin";break;case"sibling-append":n="afterend";break;default:n="beforeend"}e.insertAdjacentElement(n,this.element);const s=e=>{e.persisted&&(this.close(),window.removeEventListener("pageshow",s))};window.addEventListener("pageshow",s)}close(){var e;null===(e=this.element.parentNode)||void 0===e||e.removeChild(this.element),this.onResizeSubject$.complete(),"string"==typeof this.originalOverflowValue&&(this.services.window.document.body.style.overflow=this.originalOverflowValue)}onLoad(){return this.onLoaded}onClose(){return et(this,void 0,void 0,(function*(){var e;yield this.onLoaded,yield(e=this.element,new Promise((t=>{const i=new MutationObserver((n=>{n.forEach((n=>{const s=Array.from(n.removedNodes),r=s.indexOf(e)>-1,o=s.some((t=>t.contains&&t.contains(e)));(r||o)&&(i.disconnect(),t())}))}));i.observe(document.body,{subtree:!0,childList:!0})})))}))}onResize(){return this.onResizeSubject$.asObservable()}}class rt{constructor(t,i,n,s=new b,o,c){this._details=t,this._services=i,this._catchWrapSubscriber=n,this._internalEvents$=s,this._serviceUrlOverride=c,this.handleClose=()=>{this.sendToPartner({event:r.PLACEMENT_CLOSED,body:{}}),this._internalEvents$.complete()},this._frame=o||this.createFrame(),this._displayResolver=new e,this.setupHandlers(),this._frame.onResize().subscribe((e=>{this.sendToPartner({event:r.PLACEMENT_RESIZE,body:e})}))}getElement(){return this._frame.getElement()}getAlias(){var e;return null!==(e=this._details.alias)&&void 0!==e?e:""}on(e){const{placementsStream:t}=this._services,i=O(t.on(this._details.pluginInstanceId,l))(L((e=>e.getBody())));return this._catchWrapSubscriber(O(T(i,this._internalEvents$))(C((t=>"*"===e||t.event===e)),L((e=>({body:e.body,event:e.event,placement:this})))),(e=>{throw e.code="LAUNCHER_PLACEMENT_EVENT_PARTNER_CALLBACK_ERROR",this._services.logger.raiseWarning(e),e}))}send(e,t){return et(this,void 0,void 0,(function*(){const{placementsStream:i}=this._services;yield i.send(this._details.pluginInstanceId,e,t)}))}place(e){return et(this,void 0,void 0,(function*(){const{metricsService:t,controllerService:i,logger:n}=this._services;try{this._frame.setStyles({display:"none"});const n=yield j((()=>Promise.resolve(e||((e="")=>{const t=(i=e)?i.replace(/([\#\.])([0-9])/gi,"$1\\3$2 "):i;var i;if(!t)return window.document.body;const n=window.document.querySelector(t);if(!n)throw new Error(nt.NoElementToPlacePlugin);return n})(this._details.targetElementSelector))),50,100);this._frame.insert(n,this._details.targetElementRelation||void 0,this._details.targetElementPosition||void 0),t.triggerPluginFrameCreated(this._details.alias||"",this._details.pluginInstanceId),yield this._frame.onLoad(),this._frame.onClose().then(this.handleClose),this.sendToPartner({event:r.PLACEMENT_READY,body:{}}),yield i.framePlaced(this._details.pluginInstanceId)}catch(e){throw e.code="LAUNCHER_FAILED_TO_PLACE_PLUGIN",e.additionalInformation={placementId:this.getAlias()},n.raiseWarning(e),this._displayResolver.resolve(e),e}}))}remove(){return et(this,void 0,void 0,(function*(){return this._frame.close()}))}onClose(){return et(this,void 0,void 0,(function*(){return this._frame.onClose()}))}onDisplay(){return et(this,void 0,void 0,(function*(){const e=yield this._displayResolver.promise;if(e)throw e}))}setupHandlers(){const{placementsStream:e}=this._services;e.on(this._details.pluginInstanceId,o).subscribe((e=>et(this,void 0,void 0,(function*(){yield(({pluginRuntimeFrame:e,internalEvents$:t})=>i=>et(void 0,void 0,void 0,(function*(){const{sandbox:n,css:s,outerCss:o,applyHighestZIndex:c,autoresize:a,preset:l}=i.getBody();a&&e.useAutoResizer(),"DisplayPreset.FULLSCREEN"===l&&e.setFullscreen(),n&&e.setSandbox(n),s&&e.setStyles(s),o&&e.setStyles(o),c&&e.setStyles({zIndex:W()+1}),e.removeStyles(["display"]),t.next({event:r.DISPLAY_SETTINGS_SET,body:void 0}),i.send()})))({pluginRuntimeFrame:this._frame,internalEvents$:this._internalEvents$})(e),this._displayResolver.resolve()})))),e.on(this._details.pluginInstanceId,d).subscribe((({pluginRuntimeFrame:e})=>t=>et(void 0,void 0,void 0,(function*(){const{height:i,width:n}=t.getBody();e.setSize(i,n),t.send()})))({pluginRuntimeFrame:this._frame})),e.on(this._details.pluginInstanceId,c).subscribe((e=>{this._frame.close(),e.send()})),e.on(this._details.pluginInstanceId,a).subscribe((e=>{this._displayResolver.resolve(new Error("Placement failed to load")),e.send()}))}createFrame(){return new st(this._services,this._details,this._serviceUrlOverride)}sendToPartner(e){this._internalEvents$.next(e)}}class ot{constructor(e){this.controller=e,this._bus=new b,this.middleware=()=>e=>this._bus.next(e)}on(e,t){return O(this._bus)(C((i=>(e=>e.getHeaders()["plugin-instance-id"])(i)===e&&i.getEvent()===t)))}send(e,t,i){return et(this,void 0,void 0,(function*(){yield this.controller.send("[P] PARTNER_TO_PLUGIN",{body:{event:t,body:i},headers:{"placement-id":e}})}))}}class ct{constructor(e){this._placements=e}placeAll(){return et(this,void 0,void 0,(function*(){const e=this._mapAll((e=>e.place()));yield Promise.all(e)}))}removeAll(){return et(this,void 0,void 0,(function*(){const e=this._mapAll((e=>e.remove()));yield Promise.all(e)}))}getAll(){return this._placements}on(e){const t=this._mapAll((t=>t.on(e)));return T(...t)}onDisplay(){return et(this,void 0,void 0,(function*(){const e=this._mapAll((e=>e.onDisplay()));yield Promise.all(e)}))}send(e,t){return et(this,void 0,void 0,(function*(){const i=this._mapAll((i=>i.send(e,t)));yield Promise.all(i)}))}_mapAll(e){const t=[];for(const i of this._placements)t.push(e(i));return t}}class at{constructor(e,t){this._controllerService=t,this.placements=new ct(e)}setAttributes(e){return et(this,void 0,void 0,(function*(){yield this._controllerService.setAttributes(e)}))}}const lt=e=>e.querySelectorAll("[rokt-frame-type]");class dt{constructor(){this.fulfillmentAttributes={}}setFulfillmentAttributes(e){this.fulfillmentAttributes=this.filterAttributes(e)}getFulfillmentAttributes(){return this.fulfillmentAttributes}getHashedFulfillmentAttributes(){return et(this,void 0,void 0,(function*(){const e=Object.keys(this.fulfillmentAttributes);return 0===e.length?Promise.resolve({}):new Promise(((t,i)=>{const n=e.map((e=>q(`${this.fulfillmentAttributes[e].value}`.trim().toLowerCase())));Promise.all(n).then((i=>{const n=i.reduce(((t,i,n)=>{const s=`widget-${e[n]}sha256hex`;return t[s]={type:p,name:s,value:i},t}),{});t(n)}),i)}))}))}filterAttributes(e){return e?((e,t)=>{const i={};for(const t of Object.keys(e)){const s=e[t];(n=s).type===p&&void 0!==n.value&&null!==n.value&&""!==n.value&&(i[t]=s)}var n;return i})(e):{}}}const ut=e=>!e||"object"!=typeof e||e.constructor!==Object;class ht{constructor(e,t,i,n,s){this.window=e,this.controllerConnection=t,this.fulfillmentAttributeService=i,this.sessionService=n,this.eventsService=s}selectPlacements(e,t){return et(this,void 0,void 0,(function*(){const i={attributes:yield this.processAttributes(e),pageInstanceId:this.sessionService.pageInstanceId,pageIdentifier:t,url:this.window.location.href};try{const e=yield this.controllerConnection.send("[C] SELECT_PLACEMENTS",{body:i});return this.eventsService.emit(n.AttributesCapture),e.body}catch(e){throw this.eventsService.emit(n.AttributesCaptureFailure),e}}))}placementPlaced(e){return et(this,void 0,void 0,(function*(){yield this.controllerConnection.send("[C] PLACEMENT_PLACED",{body:{id:e}})}))}framePlaced(e){return et(this,void 0,void 0,(function*(){yield this.controllerConnection.send("[C] FRAME_LOAD_END",{body:{id:e}})}))}setAttributes(e){return et(this,void 0,void 0,(function*(){try{yield this.controllerConnection.send("[C] SET_ATTRIBUTES",{body:{pageInstanceId:this.sessionService.pageInstanceId,attributes:e}})}catch(e){throw this.eventsService.emit(n.AttributesCaptureFailure),e}}))}processAttributes(e){return et(this,void 0,void 0,(function*(){const t=Object.assign({},e),i={},n={};for(const[e,s]of Object.entries(t))(s||!1===s||0===s)&&(ut(s)?n[e]={name:e,type:v,value:s}:s.type===v?n[s.name]=s:s.type===p&&(i[s.name]=s));this.fulfillmentAttributeService.setFulfillmentAttributes(i);const s=yield this.fulfillmentAttributeService.getHashedFulfillmentAttributes(),r=Object.assign(Object.assign({},n),s);if(r.userAgent||(r.userAgent={name:"userAgent",type:v,value:this.window.navigator.userAgent}),!r.clientType){const e=function(e){const t=ce(void 0),i=t?t.os:null;if(null!==i)switch(i){case"Amazon OS":case"Android OS":case"BlackBerry OS":case"iOS":case"Windows Mobile":return"MobileWeb";default:return"DesktopWeb"}}();e&&(r.clientType={name:"clientType",type:v,value:e})}return r}))}}class vt extends class{constructor(){this.hasConnected=!1,this.transmitter=new e,this.router=new e}setEngine(e){const{router:t,transmitter:i}=e.eject();this.router.resolve(t),this.transmitter.resolve(i),this.hasConnected=!0}setRouter(e){this.router.resolve(e)}setTransmitter(e){this.transmitter.resolve(e)}addInterceptor(e){return Ie(this,void 0,void 0,(function*(){(yield this.transmitter.promise).addInterceptor(e)}))}send(e,t={}){return Ie(this,void 0,void 0,(function*(){return(yield this.transmitter.promise).send(e,t)}))}use(e){return Ie(this,void 0,void 0,(function*(){(yield this.router.promise).use(e)}))}on(e,...t){return Ie(this,void 0,void 0,(function*(){(yield this.router.promise).on(e,...t)}))}close(){return Ie(this,void 0,void 0,(function*(){(yield this.router.promise).close()}))}}{constructor(t,i){super(),this._errorReporter=t,this.constants=i,this._CONNECTION_TIMEOUT=13e3,this._connectionPromise=new e,this._setupCompletePromise=new e,this._link=(({targetOrigin:e,ID:t=80,window:i=B()})=>new Ze({targetOrigin:e,ID:t,selfEventSource:i,channelConstructor:i.MessageChannel}))({targetOrigin:"*"}),this._link.onConnection.subscribe((e=>{if(this._connectionError){const e=new U("",{code:"LAUNCHER_REJECT_LATE_CONTROLLER_CONNECTION",severity:k});this._errorReporter(e)}else{try{const s=new Ee(new ve(i={connection:e,alias:"Launcher",timeoutDuration:15e3}),new be(i));s.use((e=>t=>{t.setResponseHeader("origin",e.location.origin),t.setResponseHeader("host",e.location.host),t.setResponseHeader("href",e.location.href),t.setResponseHeader("pathname",e.location.pathname)})(window)),s.use(Ae),s.use((n=this,(e,t)=>{t&&e.hasSent()&&!(e=>e.getContext(Te))(e)&&n.send(Re,{body:t})})),s.addInterceptor((e=>t=>{t.isResponse||(t.headers=Object.assign(Object.assign({},t.headers),{host:e.location.host,origin:e.location.origin,href:e.location.href,pathname:e.location.pathname}))})(window)),s.addInterceptor((t=this.constants.VERSION,e=>{e.isResponse||(e.headers=Object.assign(Object.assign({},e.headers),{"launcher-version":t}))})),s.addInterceptor(Pe),this.setEngine(s),s.on("[L] CONTROLLER_SETUP_COMPLETE",x,(()=>this._setupCompletePromise.resolve())),this._connectionPromise.resolve()}catch(e){throw e.code="LAUNCHER_CONTROLLER_HANDLER_SETUP",e.severity=k,this._errorReporter(e),e}var t,i}var n}))}onConnection(){return et(this,void 0,void 0,(function*(){if(yield this._connectionPromise.promise,this._connectionError)throw this._connectionError}))}onSetupComplete(){return et(this,void 0,void 0,(function*(){yield this._setupCompletePromise.promise}))}connect(e){return et(this,void 0,void 0,(function*(){const t=M(this._CONNECTION_TIMEOUT).then((()=>{throw new U("",{code:"LAUNCHER_CONTROLLER_CONNECTION_TIMEOUT",severity:k})})),i=this._link.connect({target:e}).catch((()=>{throw new U("",{code:"LAUNCHER_CONTROLLER_CONNECTION_SETUP",severity:k})}));try{yield Promise.race([t,i])}catch(e){this._connectionError=e,this._connectionPromise.resolve(),this._errorReporter(e)}}))}}class pt{constructor(e,t,i,n,s,r){this._sessionService=e,this._urls=t,this._window=i,this._constants=n,this._recogniserAccessor=s,this._initOptions=r,this._controllerFrame=this._window.document.createElement("iframe"),this._controllerFrame.id=Oe,this._controllerFrame.name=this._createControllerName(),this._controllerFrame.sandbox.add("allow-scripts"),this._controllerFrame.sandbox.add("allow-same-origin"),this._controllerFrame.style.display="none",this._controllerFrame.setAttribute(u,"controller"),r.serviceUrlOverride?this._controllerFrame.src=`${r.serviceUrlOverride}/wsdk/controller/index.html`:this._controllerFrame.src=this._urls.CONTROLLER_URL}append(){return et(this,void 0,void 0,(function*(){const e=this._window.document.body||this._window.document.head,t=new Promise((e=>this._controllerFrame.onload=e));e.appendChild(this._controllerFrame),yield t}))}getWindow(){if(!this._controllerFrame.contentWindow)throw new Error("Tried to get controller frame before it was loaded");return this._controllerFrame.contentWindow}_createControllerName(){var e,t,i;const n=new URLSearchParams;return[[Ce,Oe],[Ve,this._constants.VERSION],[We,JSON.stringify(this._recogniserAccessor.getRecogniser())],[Ne,null===(e=this._sessionService.initTimestamp)||void 0===e?void 0:e.toISOString()],[Le,this._sessionService.launcherInstanceId],[xe,null===(t=this._sessionService.noDeviceId)||void 0===t?void 0:t.toString()],[ke,null===(i=this._sessionService.sandbox)||void 0===i?void 0:i.toString()],[Ue,this._sessionService.tagId],[Me,this._sessionService.integrationType],[De,this._sessionService.sessionId],[Fe,JSON.stringify(this._sessionService.customHeaders)],[Ge,this._window.location.href],[je,this._initOptions.integrationName],[He,this._initOptions.serviceUrlOverride]].forEach((e=>{const[t,i]=e;void 0!==i&&""!==i&&n.append(t,i)})),n.toString()}}class mt{constructor(){this._subject=new b,this._observable=this._subject.asObservable()}on(e){return O(this._observable)(C((({event:t})=>e===t||"*"===e)))}emit(e,t){this._subject.next({event:e,body:t})}}class ft{constructor(e,t,i="Unspecified"){this._errorReporter=e,this._controllerConnection=t,this._integrationName=i}log(e){return et(this,void 0,void 0,(function*(){yield this._controllerConnection.send("[C] LOG",{body:e})}))}raiseError(e){return et(this,void 0,void 0,(function*(){e.severity=k,yield this.raiseIssue(e)}))}raiseWarning(e){return et(this,void 0,void 0,(function*(){e.severity=D,yield this.raiseIssue(e)}))}raiseIssue(e){return et(this,void 0,void 0,(function*(){if(!this._controllerConnection.hasConnected)return this._errorReporter(e);try{const t=e.severity||k;yield this._controllerConnection.send(Re,{body:{additionalInformation:e.additionalInformation,code:e.code,level:t,integration:e.integration||this._integrationName,message:e.message||"Launcher error raised.",name:e.name||"LauncherError",reporter:"WSDK",severity:t,stack:e.stack}})}catch(t){this._errorReporter(e)}}))}}class _t{constructor(e,t,i,n="Unspecified"){this._integrationName=n,this._controllerConnection=e,this._windowRef=t,this._sessionService=i}trigger(e,t=!1){return et(this,void 0,void 0,(function*(){try{yield this._controllerConnection.send("[C] PUT_METRIC_EVENT",{body:Object.assign(Object.assign({},e),{timestamp:e.timestamp.toISOString(),launcherInstanceId:this._sessionService.launcherInstanceId,pageInstanceId:t&&this._sessionService.pageInstanceId||e.pageInstanceId||void 0,data:Object.assign({},e.data)})})}catch(e){}}))}triggerPageStart(e){var t,i;return et(this,void 0,void 0,(function*(){const n=null===(i=null===(t=this._windowRef.performance)||void 0===t?void 0:t.timing)||void 0===i?void 0:i.responseStart;(e||n&&!(Date.now()-n>36e5))&&(yield this.trigger({type:"PAGE_START",timestamp:e||new Date(n)},!0))}))}triggerIntegrationStart(e=new Date){return et(this,void 0,void 0,(function*(){const t={integrationName:this._integrationName};yield Promise.all([this.trigger({type:"INTEGRATION_START",timestamp:e,data:t},!0),this.trigger({type:"ROKT_START",timestamp:e},!0)])}))}triggerLauncherStart(e){return et(this,void 0,void 0,(function*(){yield this.trigger({type:"LAUNCHER_START",timestamp:e||new Date})}))}triggerControllerFrameCreated(){return et(this,void 0,void 0,(function*(){yield this.trigger({type:"CONTROLLER_FRAME_CREATED",timestamp:new Date})}))}triggerSelectionStart(e,t){return et(this,void 0,void 0,(function*(){yield this.trigger({type:"SELECTION_START",timestamp:t,pageInstanceId:e})}))}triggerSelectionEnd(e){return et(this,void 0,void 0,(function*(){yield this.trigger({type:"SELECTION_END",timestamp:new Date,pageInstanceId:e})}))}triggerPluginFrameCreated(e,t){return et(this,void 0,void 0,(function*(){const i={type:h,timestamp:new Date,pluginAlias:e,pluginInstanceId:t};yield this.trigger(Object.assign(Object.assign({},i),{type:h}),!0),yield this.trigger(Object.assign(Object.assign({},i),{type:"PLUGIN_RUNTIME_FRAME_CREATED"}),!0)}))}}class gt{constructor(e,t){this._urls=e,this._windowRef=t}preloadPluginRuntime(){return et(this,void 0,void 0,(function*(){return this._createPreloadIframe(this._urls.PLUGIN_RUNTIME_URL)}))}preloadWidgetPlugin(){return et(this,void 0,void 0,(function*(){return this._createPreloadIframe(this._urls.WIDGET_PLUGIN_URL)}))}_createPreloadIframe(e){return et(this,void 0,void 0,(function*(){const t=new URLSearchParams;t.append("integration_type","preload"),t.append("init_timestamp",String((new Date).getTime()));const i=t.toString(),n=this._windowRef.document.createElement("iframe");n.style.display="none",n.name=i,n.src=e;const s=new Promise((e=>n.onload=e)),r=this._windowRef.document.body||this._windowRef.document.head;r.appendChild(n),yield s,n.onload=null,r.removeChild(n)}))}}class wt{constructor(e){this.CONTROLLER_URL=`${e.SDK_ORIGIN}/controller/index.html`,this.PLUGIN_RUNTIME_URL=`${e.SDK_ORIGIN}/plugin-runtime/index.html`,this.WIDGET_PLUGIN_URL=e.WIDGET_PLUGIN_URL}}class yt{constructor(e){this.initTimestamp=e.initTimestamp||new Date,this.integrationType=e.integrationType||s.Default,this.noDeviceId=e.noDeviceId||!1,this.sandbox=e.sandbox||!1,this.sessionId=e.sessionId,this.tagId=e.tagId,this.pageInstanceId=e.pageInstanceId||this.getNewPageInstanceGuid(),this.launcherInstanceId=Qe(),this.customHeaders=e.customHeaders}resetPageId(){this.pageInstanceId=this.getNewPageInstanceGuid()}getNewPageInstanceGuid(){return Qe()}}class bt{constructor(e,t){this.initOptions=e,this.window=B(),this.constants=(()=>{let e;return e=void 0==={ENVIRONMENT:"PROD",VERSION:"3.4.0",SDK_ORIGIN:"https://apps.rokt.com/wsdk",WIDGET_PLUGIN_URL:"https://apps.rokt.com/wsdk/plugins/widget/index.html"}?{ENVIRONMENT:"LOCAL",VERSION:it||"",SDK_ORIGIN:"",SANDBOX_SDK_ORIGIN:"",WIDGET_PLUGIN_URL:""}:{ENVIRONMENT:"PROD",VERSION:"3.4.0",SDK_ORIGIN:"https://apps.rokt.com/wsdk",WIDGET_PLUGIN_URL:"https://apps.rokt.com/wsdk/plugins/widget/index.html"},e.VERSION=it||e.VERSION,e.SDK_ORIGIN=e.SDK_ORIGIN||"%%SDK_ORIGIN%%",e.SANDBOX_SDK_ORIGIN=e.SANDBOX_SDK_ORIGIN||"%%SANDBOX_SDK_ORIGIN%%",e})(),this.controllerConnection=new vt(t,this.constants),this.logger=new ft(t,this.controllerConnection,this.initOptions.integrationName),this.eventsService=new mt,this.cookieService=new V(this.window),this.localStorageService=new $(this.window),this.recogniserAccessor=new z(this.cookieService,this.localStorageService),this.urls=new wt(this.constants),this.preloadService=new gt(this.urls,this.window),this.fulfillmentAttributeService=new dt,this.sessionService=new yt(this.initOptions),this.controllerFrame=new pt(this.sessionService,this.urls,this.window,this.constants,this.recogniserAccessor,this.initOptions),this.controllerService=new ht(this.window,this.controllerConnection,this.fulfillmentAttributeService,this.sessionService,this.eventsService),this.metricsService=new _t(this.controllerConnection,this.window,this.sessionService,this.initOptions.integrationName),this.placementsStream=new ot(this.controllerConnection)}}class St{constructor(e){var t,i;const s=new Date;var r;this._initOptions=e,this._initOptions.integrationVersion&&(r=this._initOptions.integrationVersion,it=r),this.fromController=new b;const u=((e,t=!1,i="Unspecified")=>n=>{(0,F.reportError)({tagId:e,useSandbox:t,integration:i,reporter:n.reporter||"WSDK",message:n.message,name:n.name,stack:n.stack,additionalInformation:n.additionalInformation,code:n.code,severity:n.severity})})(e.tagId,e.sandbox,this._initOptions.integrationName);try{this.services=new bt(this._initOptions,u);const{controllerConnection:e,controllerFrame:r,metricsService:h,placementsStream:v,preloadService:p}=this.services;r.append().then((()=>e.connect(r.getWindow()))).catch((e=>{throw e.code=e.code||"LAUNCHER_CONTROLLER_CONNECTION",u(e),e})),h.triggerControllerFrameCreated(),this._initOptions.skipPreload||(p.preloadPluginRuntime(),p.preloadWidgetPlugin()),h.triggerPageStart(null!==(t=this._initOptions.pageInitTimestamp)&&void 0!==t?t:void 0),h.triggerIntegrationStart(null!==(i=this._initOptions.initTimestamp)&&void 0!==i?i:s),h.triggerLauncherStart(s),e.on(o,v.middleware()),e.on(c,v.middleware()),e.on(a,v.middleware()),e.on(d,v.middleware()),e.on(l,x,v.middleware()),e.on("[L] GET_FULFILLMENT_ATTRIBUTES",(({fulfillmentAttributeService:e})=>t=>{const i=e.getFulfillmentAttributes();t.send({fulfillmentAttributes:i})})(this.services)),e.on("[L] SEND_LAUNCHER_EVENT",(({eventsService:e})=>t=>{const i=t.getBody();i&&i.name&&e.emit(i.name,i.payload),t.send()})(this.services)),e.on("[L] SET_FIRST_PARTY_RECOGNISER",(({recogniserAccessor:e})=>t=>{const i=t.getBody();e.setRecogniser(i.firstPartyRecogniser),t.send()})(this.services)),e.on("[L] SET_SESSION_ID",(({sessionService:e})=>t=>{const i=t.getBody();e.sessionId=i.sessionId,t.send()})(this.services)),e.on("[L] ATTRIBUTES_CAPTURE_RESULT",(({eventsService:e})=>t=>{t.getBody().isSuccess?e.emit(n.AttributesCapture):e.emit(n.AttributesCaptureFailure),t.send()})(this.services)),e.on("[L] CONTROLLER_TO_PARTNER",(e=>this.fromController.next(e.getBody())),x),e.on("[L] CREATE_PLUGIN",(e=>{var t=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(i[n[s]]=e[n[s]])}return i}(e,[]);return e=>{const i=e.getBody();new rt(i,t,A,void 0,void 0,t.initOptions.serviceUrlOverride).place(),e.send()}})(this.services))}catch(e){throw e.code=e.code||"LAUNCHER_INIT",u(e),e}}on(e){const t=this.services.eventsService;return O(T(this.fromController,t.on("*")))(C((t=>"*"===e||t.event===e)))}getSessionInfo(){return et(this,void 0,void 0,(function*(){const{sessionService:e}=this.services;return{isSandboxedSession:e.sandbox,sessionId:e.sessionId||"",tagId:e.tagId}}))}log(e){return et(this,void 0,void 0,(function*(){const{logger:t}=this.services;yield t.log(e)}))}logMetric(e,t){return et(this,void 0,void 0,(function*(){const{metricsService:i}=this.services;yield i.trigger({type:e,timestamp:t})}))}raiseError(e){return et(this,void 0,void 0,(function*(){const{logger:t}=this.services;yield t.raiseIssue(e)}))}ready(){return et(this,void 0,void 0,(function*(){const{controllerConnection:e}=this.services;yield e.onConnection()}))}selectPlacements({attributes:e,pageIdentifier:i}){return et(this,void 0,void 0,(function*(){const{controllerConnection:n,controllerService:s,sessionService:r,metricsService:o}=this.services;yield n.onSetupComplete();const c=new Date;if(r.pageInstanceId===this.previousPageInstanceId)throw new U(t,{code:t,severity:D});const a=yield s.selectPlacements(e,i);this.previousPageInstanceId=r.pageInstanceId;const l=a.placements.map((e=>new rt(e,this.services,A,void 0,void 0,this.services.initOptions.serviceUrlOverride))),d=new at(l,s);return o.triggerSelectionStart(r.pageInstanceId,c),o.triggerSelectionEnd(r.pageInstanceId),d}))}destroy(){lt(window.document).forEach((e=>{var t;return null===(t=null==e?void 0:e.parentNode)||void 0===t?void 0:t.removeChild(e)})),this.services.window[tt]=void 0}changePage(e){var t;const i=new Date;this.services.sessionService.resetPageId(),this.services.metricsService.triggerPageStart(null!==(t=null==e?void 0:e.pageInitTimestamp)&&void 0!==t?t:i),this.services.metricsService.triggerIntegrationStart(i)}}const Et=e=>et(void 0,void 0,void 0,(function*(){return window[tt]&&!window["__rokt-launcher-allow-multiple__"]||(window[tt]=Promise.resolve(new St(e))),window[tt]}));function It(){const e=ce();switch(null==e?void 0:e.name){case"chrome":return parseFloat(null==e?void 0:e.version)>=52;case"ie":case"safari":case"ios":return parseFloat(null==e?void 0:e.version)>=11;case"ios-webview":return parseFloat(null==e?void 0:e.version)>=604;default:return!0}}const Tt={HashArgumentTypeOf:"Value to be hashed must be of type string"},At=e=>et(void 0,void 0,void 0,(function*(){if("string"!=typeof e)throw new Error(Tt.HashArgumentTypeOf);return q(e.trim().toLocaleLowerCase())}));var Rt=Object.freeze({__proto__:null,RoktEvent:r,LauncherEvent:n,createLauncher:Et,LauncherInstance:St,ServiceContainer:bt,findFrames:lt,ErrorType:nt,PlacementInstance:rt,PlacementStream:ot,PlacementCollection:ct,Selection:at,isBrowserSupported:It,ErrorMessage:Tt,hashString:At});const Pt="GENERAL_ERROR",Ot=Object.assign(Object.assign({},n),{Failure:"FAILURE"});class Ct{constructor(e){this._placement=e}getAlias(){return this._placement.getAlias()}getElement(){return this._placement.getElement()}on(e){return O(this._placement.on(e))(L((e=>e.body)))}onClose(){return this._placement.onClose()}remove(){return this._placement.remove()}send(e,t){return this._placement.send(e,t)}}var Nt=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};class Lt{constructor(e,t,i,n,s,r,o,c,a){this._attributesService=e,this._configService=t,this._fulfillmentAttributesService=i,this._pageService=s,this._roktEventsService=r,this._selectionService=o,this._validationService=c,this.cart=a,this.roktConfiguration={},this._failureUnsubscriber=null,this._positiveEngagementCallback=null,this.RoktEventType=Ot,this.version="AL-2.4.0",this._selectionService.onSelectionComplete((()=>{n.then((e=>Nt(this,void 0,void 0,(function*(){const t=yield e.getSessionInfo();this.roktConfiguration.sessionId=t.sessionId}))))}))}init(e){this._configService.set(e)}onLoaded(e){e(this)}on(e){return this._roktEventsService.on(e)}closeAll(){this._selectionService.clearSelection()}getPlacements(){return Nt(this,void 0,void 0,(function*(){const e=yield this._selectionService.getCurrentSelection();return e?e.placements.getAll().map((e=>new Ct(e))):[]}))}hashString(e){return At(e)}onFailure(e){this._failureUnsubscriber&&this._failureUnsubscriber.unsubscribe(),this._failureUnsubscriber=this._roktEventsService.on(Ot.Failure).subscribe(e)}onPositiveEngagement(e){this._positiveEngagementCallback||this._selectionService.onPositiveEngagement((()=>{this._positiveEngagementCallback()})),this._positiveEngagementCallback=e}setAttributes(e){this._selectionService.hasSelection()?this._selectionService.getCurrentSelection().then((t=>{t?t.setAttributes(e):this._attributesService.set(e)})):this._attributesService.set(e)}setFulfillmentAttributes(e){this._fulfillmentAttributesService.set(e)}triggerPageChange(e){this._pageService.changePage(e)}getValidationStatus(){return this._validationService.getValidationStatus()}}var xt=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};class kt{constructor(){this._attributes={}}clear(){this._attributes={}}get(){return xt(this,void 0,void 0,(function*(){return this._attributes}))}set(e){return xt(this,void 0,void 0,(function*(){this._attributes=Object.assign(Object.assign({},this._attributes),e)}))}}var Dt=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};class Ut{constructor(e){this._errorService=e,this._attributes={},this._rawAttributes={},this._hashingPending=Promise.resolve()}clear(){this._attributes={}}clearRaw(){this._rawAttributes={}}get(){return Dt(this,void 0,void 0,(function*(){return yield this._hashingPending,this._attributes}))}getRaw(){return this._rawAttributes}set(t){return Dt(this,void 0,void 0,(function*(){const i=this._hashingPending,n=new e;this._hashingPending=n.promise,yield i,this._rawAttributes=Object.assign(Object.assign({},this._rawAttributes),t),this._attributes=Object.assign(Object.assign({},this._attributes),yield this.hash(t)),n.resolve()}))}hash(e){return Dt(this,void 0,void 0,(function*(){const t={};try{const i=Object.entries(e).filter((([e,t])=>null!=t&&""!==t)).map((([e,i])=>Dt(this,void 0,void 0,(function*(){const n=`${e}sha256`,s=yield Rt.hashString(String(i));t[n]=s}))));yield Promise.all(i)}catch(e){e.code="HASHING_FAILED",this._errorService.report(e)}return t}))}}class Ft{constructor(e,t){e.onSelectionComplete((e=>{const i=e.placements.on(r.UPDATE_CART_ITEM_MESSAGE).subscribe((e=>{return i=this,n=void 0,r=function*(){if(this._callback)try{yield this._callback(e.body.cartItem,e.body.oldCartItem)}catch(e){throw e.code="CART_UPDATE_CALLBACK_FAILURE",e.severity=D,t.report(e),e}},new((s=void 0)||(s=Promise))((function(e,t){function o(e){try{a(r.next(e))}catch(e){t(e)}}function c(e){try{a(r.throw(e))}catch(e){t(e)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof s?i:new s((function(e){e(i)}))).then(o,c)}a((r=r.apply(i,n||[])).next())}));var i,n,s,r}));return()=>i.unsubscribe()}))}onUpdateItem(e){this._callback=e}}var Mt=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};class jt{constructor(t){this._optionsPromise=new e,this._options={skipPreload:!1},this.integrationType=this._getIntegrationType(),this.noDeviceId=this._get("noDeviceId"),this.initialPageIdentifier=this._get("pageIdentifier"),this.initialPageLoadTimestamp=this._get("pageInitTimestamp"),this.sandbox=this._get("sandbox"),this.sessionId=this._get("sessionId"),this.skipInitialSelection=this._get("skipInitialSelection"),this.customHeaders=this._get("customHeaders"),this.skipPreload=this._get("skipPreload"),this.tagId=Promise.resolve(t.id),this.roktStartTimestamp=Promise.resolve(t.initTimestamp),this._init(t)}set(e){this._options=Object.assign(Object.assign({},this._options),e)}_init(e){return Mt(this,void 0,void 0,(function*(){yield e.onInitialised,this._optionsPromise.resolve(this._options)}))}_get(e){return Mt(this,void 0,void 0,(function*(){return(yield this._optionsPromise.promise)[e]}))}_getIntegrationType(){return Mt(this,void 0,void 0,(function*(){return((e,t,i)=>{if(null==e&&void 0!==i)return i;if(Object.values(t).includes(e))return e;throw new Error("ValueDoesNotExistInEnum")})(yield this._get("integrationType"),s,s.Default)}))}}var Gt=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};class Wt{constructor(e,t,i){this._fallbackReporter=e;const n=i.getRoktObject();n&&"id"in n&&(this._tagId=n.id),this._init(t)}report(e){return Gt(this,void 0,void 0,(function*(){if(this._launcher)this._launcher.raiseError(e);else{const t={additionalInformation:e.additionalInformation,code:e.code,integration:"auto-launcher-2",message:e.message,name:e.name,reporter:e.reporter||"WSDK",severity:e.severity,stack:e.stack,tagId:this._tagId};this._fallbackReporter(t)}}))}_init(e){return Gt(this,void 0,void 0,(function*(){this._launcher=yield e}))}}class Ht{constructor(e){this._launcherPromise=e}log(e,t){return i=this,n=void 0,r=function*(){try{const i=yield this._launcherPromise;yield i.logMetric(e,t)}catch(e){}},new((s=void 0)||(s=Promise))((function(e,t){function o(e){try{a(r.next(e))}catch(e){t(e)}}function c(e){try{a(r.throw(e))}catch(e){t(e)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof s?i:new s((function(e){e(i)}))).then(o,c)}a((r=r.apply(i,n||[])).next())}));var i,n,s,r}}var Vt=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};class Bt{constructor(e,t,i,n,s){this._config=e,this._selectionService=t,this._attributesService=i,this._fulfillmentAttributesService=n,this._launcherPromise=s,this._selectionService.onSelectionComplete(this._getDisplayPlacementsCallback()),this._selectionService.onPositiveEngagement(this._getPositiveEngagementCallback())}initPage(){return Vt(this,void 0,void 0,(function*(){const e=yield this._config.initialPageIdentifier;yield this._performSelection(e)}))}changePage(e){return Vt(this,void 0,void 0,(function*(){this._selectionService.clearSelection(),this._selectionService.initialiseSelectionPromise(),(yield this._launcherPromise).changePage(e),yield this._performSelection(e.pageIdentifier)}))}_performSelection(e){return Vt(this,void 0,void 0,(function*(){const t=Object.assign(Object.assign({},yield this._attributesService.get()),yield this._fulfillmentAttributesService.get());this._attributesService.clear(),this._fulfillmentAttributesService.clear(),yield this._selectionService.selectPlacements({pageIdentifier:e,attributes:t})}))}_getDisplayPlacementsCallback(){return e=>Vt(this,void 0,void 0,(function*(){try{yield e.placements.placeAll()}catch(e){}return()=>e.placements.removeAll()}))}_getPositiveEngagementCallback(){return e=>Vt(this,void 0,void 0,(function*(){const t=this._fulfillmentAttributesService.getRaw();this._fulfillmentAttributesService.clearRaw(),Object.keys(t).length&&(yield e.setAttributes(t))}))}}class $t{constructor(e,t,i){this._launcherPromise=e,this._errorReporter=t,this._catchWrapSubscriber=i,this._events=new b,this._launcherFailureEvent=[n.AttributesCaptureFailure],this._initLauncherSubscription(),this._initLauncherFailuresMapping()}on(e){return this._catchWrapSubscriber(O(this._events)(C((t=>"*"===e||t.event===e)),L((t=>"*"===e?t:t.body))),(e=>{throw e.code="PARTNER_EVENT_CALLBACK_FAILURE",e.severity=D,this._errorReporter.report(e),e}))}triggerFailure(e){this._events.next({event:Ot.Failure,body:e})}_initLauncherSubscription(){return e=this,t=void 0,n=function*(){try{const e=yield this._launcherPromise;O(e.on("*"))(L((e=>e))).subscribe(this._events)}catch(e){}},new((i=void 0)||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}));var e,t,i,n}_initLauncherFailuresMapping(){O(this._events)(C((({event:e})=>this._launcherFailureEvent.includes(e))),L((()=>({event:Ot.Failure,body:Pt})))).subscribe((e=>{this._events.next(e)}))}}var Kt=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};class zt{constructor(e){this._errorReporter=e,this._selectionCallbacks=[],this._teardownCallbacks=[],this._eventCallbacks=[]}onSelection(e){this._selectionCallbacks.push(this._wrapCallback("SELECTION_CALLBACK_FAILURE",e))}onEvent(e,t){this._eventCallbacks.push([e,this._wrapCallback(`${e}_EVENT_CALLBACK_FAILURE`,t)])}initializeSelection(e){this._teardownCallbacks=this._selectionCallbacks.map((t=>t(e))),this._subscribeSelectionEvents(e)}teardown(){return Kt(this,void 0,void 0,(function*(){const e=this._teardownCallbacks;this._teardownCallbacks=[],yield Promise.all(e.map((e=>Kt(this,void 0,void 0,(function*(){const t=yield e;if(t)return this._wrapCallback("TEARDOWN_CALLBACK_FAILURE",t)()})))))}))}_wrapCallback(e,t){return(...i)=>Kt(this,void 0,void 0,(function*(){try{return yield t(...i)}catch(t){throw t.code=e,this._errorReporter.report(t),t}}))}_subscribeSelectionEvents(e){const t=new _;this._eventCallbacks.forEach((([i,n])=>{t.add(e.placements.on(i).subscribe((()=>n(e))))})),this._teardownCallbacks.push((()=>{t.unsubscribe()}))}}class Yt{constructor(t,i,n,s){this._callbackContainer=t,this._errorService=i,this._eventsService=n,this._launcherPromise=s,this._selectionPromise=new e,this._hasSelection=!1,this._currentSelectionId=0}selectPlacements(e){return i=this,n=void 0,r=function*(){const i=this._currentSelectionId=this._currentSelectionId+1;let n;this._hasSelection=!0;const s=yield this._launcherPromise;try{n=yield s.selectPlacements(e)}catch(e){throw this._hasSelection=!1,this._selectionPromise.resolve(null),e.code!==t&&(e.code="SELECTION_FAILURE"),e.severity=e.severity||k,this._errorService.report(e),this._eventsService.triggerFailure(Pt),e}i===this._currentSelectionId&&this._selectionPromise.isPending()&&(this._callbackContainer.initializeSelection(n),this._hasSelection=!0,this._selectionPromise.resolve(n))},new((s=void 0)||(s=Promise))((function(e,t){function o(e){try{a(r.next(e))}catch(e){t(e)}}function c(e){try{a(r.throw(e))}catch(e){t(e)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof s?i:new s((function(e){e(i)}))).then(o,c)}a((r=r.apply(i,n||[])).next())}));var i,n,s,r}hasSelection(){return this._hasSelection}getCurrentSelection(){return this._selectionPromise.promise}initialiseSelectionPromise(){this._selectionPromise.isPending()&&this._selectionPromise.resolve(null),this._selectionPromise=new e}clearSelection(){this._selectionPromise.isFulfilled()&&(this._selectionPromise=new e),this._hasSelection=!1,0!==this._currentSelectionId&&this._selectionPromise.resolve(null),this._callbackContainer.teardown()}onSelectionComplete(e){this._callbackContainer.onSelection(e)}onPositiveEngagement(e){this._callbackContainer.onEvent(r.POSITIVE_ENGAGEMENT,e)}}class Xt{constructor(t,i,n){this._globalAccessor=t,this._errorService=i,this._eventsService=n,this._initialisedPromise=new e;try{const e=this._globalAccessor.getRoktObject();if(!e)throw new U(m,{code:m,severity:D});if(!e.id)throw new U(f,{code:f,severity:D});this._snippet=e}catch(e){throw this._errorService.report(e),this._eventsService.triggerFailure(e.code===f?"NO_TAG_ID":"NO_SNIPPET"),e}}get id(){return this._snippet.id}get initTimestamp(){return this._snippet.it}get onInitialised(){return this._initialisedPromise.promise}initialise(e){return t=this,i=void 0,s=function*(){try{this._globalAccessor.setRoktObject(e),yield Promise.all(this._snippet.lc.map((t=>t(e)))),this._initialisedPromise.resolve()}catch(e){throw e.code="ON_LOADED_CALLBACK",e.severity=D,this._errorService.report(e),this._eventsService.triggerFailure("ON_LOADED_CALLBACK_ERROR"),e}},new((n=void 0)||(n=Promise))((function(e,r){function o(e){try{a(s.next(e))}catch(e){r(e)}}function c(e){try{a(s.throw(e))}catch(e){r(e)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(o,c)}a((s=s.apply(t,i||[])).next())}));var t,i,n,s}}class qt{constructor(e){this.selectionService=e,this._validationStatesSubject=new S(1),e.onSelectionComplete((e=>this._onSelection(e)))}getValidationStatus(){return e=this,t=void 0,n=function*(){var e,t,i,n,s;return yield this.selectionService.getCurrentSelection(),(yield(e=this._validationStatesSubject,t=void 0,i=void 0,n=void 0,s=function*(){let t,i=!1;const n=new Promise(((n,s)=>{t=e.subscribe((e=>{i=!0,n(e)}),(e=>s(e)),(()=>{i||n(void 0)}))})),s=yield n;return t&&i&&t.unsubscribe(),s},new(n||(n=Promise))((function(e,r){function o(e){try{a(s.next(e))}catch(e){r(e)}}function c(e){try{a(s.throw(e))}catch(e){r(e)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(o,c)}a((s=s.apply(t,i||[])).next())})))).reduce(((e,t)=>(t.placement.send("SHOW_PARTNER_VALIDATION_STATUS"),t.errors.length&&(e.isValid=!1,e.placements.push({element:t.placement.getElement(),errors:t.errors})),e)),{isValid:!0,placements:[]})},new((i=void 0)||(i=Promise))((function(s,r){function o(e){try{a(n.next(e))}catch(e){r(e)}}function c(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}));var e,t,i,n}_onSelection(e){const t=((...e)=>new y((t=>{const i=new _,n=new Array(e.length),s=new Array(e.length),r=e=>!n.includes(void 0)&&t.next(e);for(let t=0;t<e.length;t++){const o=e[t].subscribe((e=>{s[t]=e,n[t]=!0,r(s)}));i.add(o)}return()=>i.unsubscribe()})))(...e.placements.getAll().map((e=>this._createValidationStateStream(e)))).subscribe((e=>{this._validationStatesSubject.next(e)}));return()=>{t.unsubscribe(),this._validationStatesSubject.next([])}}_createValidationStateStream(e){return new y((t=>{const i=O(T(O(e.on("OPT_IN_TO_PARTNER_VALIDATION"))(L((()=>!0))),O(e.on(r.DISPLAY_SETTINGS_SET))(L((()=>!1)))))(N()),n=O(i)(C((e=>!e)),L((()=>[]))),s=O(e.on("SET_PARTNER_VALIDATION_STATUS"))(L((e=>e.body.errors))),o=O(T(n,s))(L((t=>({placement:e,errors:t})))).subscribe(t.next,t.error,t.complete);return e.onClose().then((()=>{t.next({placement:e,errors:[]}),t.complete()})),()=>o.unsubscribe()}))}}const Jt=new Date,Zt=new class{constructor(e){this._rootObject=e,this._key=this._rootObject._ROKT_}getRoktObject(){if(this._key)return this._rootObject[this._key]}setRoktObject(e){this._rootObject[this._key]=e}}(window);var Qt,ei,ti,ii,ni,si,ri,oi;Qt=(e,t)=>{return i=void 0,n=void 0,r=function*(){const i=new Wt(F.reportError,t,e),n=new $t(t,i,A),s=new Xt(e,i,n),r=new jt(s),o=((e,t,i,n)=>()=>{return s=void 0,r=void 0,c=function*(){try{const i={integrationName:"auto-launcher-2",customHeaders:yield t.customHeaders,initTimestamp:yield t.roktStartTimestamp,integrationType:yield t.integrationType,integrationVersion:"AL-2.4.0",noDeviceId:yield t.noDeviceId,pageInitTimestamp:yield t.initialPageLoadTimestamp,sandbox:yield t.sandbox,sessionId:yield t.sessionId,skipPreload:yield t.skipPreload,tagId:yield t.tagId};return yield e(i)}catch(e){throw e.code="FAILED_TO_INITIALISE_LAUNCHER",i.report(e),n.triggerFailure(Pt),e}},new((o=void 0)||(o=Promise))((function(e,t){function i(e){try{a(c.next(e))}catch(e){t(e)}}function n(e){try{a(c.throw(e))}catch(e){t(e)}}function a(t){var s;t.done?e(t.value):(s=t.value,s instanceof o?s:new o((function(e){e(s)}))).then(i,n)}a((c=c.apply(s,r||[])).next())}));var s,r,o,c})(Et,r,i,n),c=new kt,a=new Ut(i),l=new Yt(new zt(i),i,n,t),d=new Bt(r,l,c,a,t),u=new Ht(t),h=new qt(l),v=new Ft(l,i);return{attributesService:c,fulfillmentAttributesService:a,configService:r,launcherFactory:o,metricsService:u,rokt:new Lt(c,r,a,t,d,n,l,h,v),snippetService:s,selectionService:l,pageService:d}},new((s=void 0)||(s=Promise))((function(e,t){function o(e){try{a(r.next(e))}catch(e){t(e)}}function c(e){try{a(r.throw(e))}catch(e){t(e)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof s?i:new s((function(e){e(i)}))).then(o,c)}a((r=r.apply(i,n||[])).next())}));var i,n,s,r},ei=Zt,ti=Jt,ii=function(e){if(It())return!0;const t=function(){const e="BROWSER_NOT_SUPPORTED";return{version:"0",RoktEventType:Ot,init:()=>{},onLoaded:()=>{},on:t=>({subscribe:(i,n,s)=>(i&&("*"===t?i({event:Ot.Failure,body:e}):t===Ot.Failure&&i(e),s&&s()),{unsubscribe:()=>{}})}),onFailure:t=>{t(e)},closeAll:()=>{},getPlacements:()=>Promise.resolve([]),hashString:()=>Promise.resolve(""),onPositiveEngagement:()=>{},setAttributes:()=>{},setFulfillmentAttributes:()=>{},triggerPageChange:()=>{},getValidationStatus:()=>Promise.resolve({isValid:!0,placements:[]}),cart:{onUpdateItem:()=>{}}}}(),i=e.getRoktObject();if(i)try{i.lc.forEach((e=>e(t)))}catch(e){}return!1},ni=void 0,si=void 0,oi=function*(){var t;if(!ii(ei))return;if("function"==typeof(null===(t=ei.getRoktObject())||void 0===t?void 0:t.init))return;const i=new e,{configService:n,launcherFactory:r,metricsService:o,pageService:c,rokt:a,snippetService:l}=yield Qt(ei,i.promise);yield l.initialise(a),i.resolve(r()),l.initTimestamp&&o.log("TAG_START",l.initTimestamp),o.log("AUTO_LAUNCHER_START",ti),(yield n.skipInitialSelection)||(yield n.integrationType)===s.Preload||(yield c.initPage())},new((ri=void 0)||(ri=Promise))((function(e,t){function i(e){try{s(oi.next(e))}catch(e){t(e)}}function n(e){try{s(oi.throw(e))}catch(e){t(e)}}function s(t){var s;t.done?e(t.value):(s=t.value,s instanceof ri?s:new ri((function(e){e(s)}))).then(i,n)}s((oi=oi.apply(ni,si||[])).next())}))})()})();